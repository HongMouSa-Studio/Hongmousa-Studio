<section id="products" class="product-section">
  <div class="section-header">
    <h2 class="section-title">{{ i18n "product_section_title" }}</h2>
    <span class="section-sub">{{ i18n "product_section_sub" }}</span>
  </div>

  <div class="product-grid">
    {{ range (where .Site.RegularPages "Section" "products").ByWeight }}
    <div class="product-card">
      <div class="product-image-wrapper">
        <img
          src="{{ .Params.image }}"
          alt="{{ .Title }}"
          class="product-img"
        />

        <!-- Dynamic Buttons based on Product Type -->
        <div class="product-actions-overlay">
          {{ if eq .Params.product_type "app" }}
            {{ if .Params.app_store_url }}
              <a href="{{ .Params.app_store_url }}" class="app-badge-btn" target="_blank" rel="noopener">
                <i class="fab fa-apple"></i> {{ i18n "product_badge_app_store" }}
              </a>
            {{ end }}
            {{ if .Params.google_play_url }}
              <a href="{{ .Params.google_play_url }}" class="app-badge-btn" target="_blank" rel="noopener">
                <i class="fab fa-google-play"></i> {{ i18n "product_badge_google_play" }}
              </a>
            {{ end }}
          {{ else if eq .Params.product_type "service" }}
            <a href="{{ .Params.contact_url | default "/contact/" }}" class="service-action-btn">
              {{ i18n "product_btn_book" | default "Book Now" }}
            </a>
          {{ else }}
            <!-- Default to Physical -->
            <button
              class="snipcart-add-item add-to-cart-btn"
              data-item-id="{{ .Params.id }}"
              data-item-price="{{ .Params.price }}"
              data-item-url="{{ .RelPermalink }}"
              data-item-image="{{ .Params.image }}"
              data-item-name="{{ .Title }}"
              data-item-description="{{ .Params.description }}"
              
              {{ range $index, $opt := .Params.options }}
                {{ $snipIndex := add $index 1 }}
                {{ $slug := index (slice "font" "conversion" "material" "engraving") $index }}
                data-item-custom{{ $snipIndex }}-name="{{ $slug }}"
                data-item-custom{{ $snipIndex }}-options="{{ range $vIndex, $val := $opt.values }}{{ if $vIndex }}|{{ end }}{{ if reflect.IsMap $val }}{{ $val.name }} {{ if $val.price }}[+{{ printf "%.2f" $val.price }}]{{ end }}{{ else }}{{ $val }}{{ end }}{{ end }}"
              {{ end }}
            >
              {{ i18n "product_btn_add" }}
            </button>
          {{ end }}
        </div>
      </div>
      <div class="product-info">
        <h3 class="font-serif">{{ .Title }}</h3>
        <p>{{ .Params.category }} / {{ index .Params.tags 0 }}</p>
        <div class="product-price">
          {{ if gt .Params.price 0 }}
            {{ printf (i18n "product_price_format") .Params.price }}
          {{ else }}
            {{ i18n "product_price_free" | default "Free" }}
          {{ end }}
        </div>
        <!-- Learn More Link -->
        <a href="{{ .RelPermalink }}" class="learn-more-link">
          {{ i18n "product_learn_more" }}
        </a>
      </div>
    </div>
    {{ end }}
  </div>
</section>
