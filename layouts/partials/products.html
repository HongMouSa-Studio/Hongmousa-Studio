<section id="products" class="product-section">
  <div class="container">
    <div class="section-header">
      <h2 class="font-serif">{{ i18n "product_section_title" }}</h2>
      <span class="section-sub">{{ i18n "product_section_sub" }}</span>
    </div>

    <div class="product-grid">
      {{ range (where .Site.RegularPages "Section" "products").ByWeight }}
      <div class="product-card">
        <div class="product-image-wrapper">
          <img
            src="{{ .Params.image }}"
            alt="{{ .Title }}"
            class="product-img"
          />

          <!-- Snipcart Button -->
          <button
            class="snipcart-add-item add-to-cart-btn"
            data-item-id="{{ .Params.id }}"
            data-item-price="{{ .Params.price }}"
            data-item-url="{{ .RelPermalink }}"
            data-item-image="{{ .Params.image }}"
            data-item-name="{{ .Title }}"
            data-item-description="{{ .Params.description }}"
            
            {{ range $index, $opt := .Params.options }}
              {{ $snipIndex := add $index 1 }}
              {{ $slug := index (slice "font" "conversion" "material" "engraving") $index }}
              data-item-custom{{ $snipIndex }}-name="{{ $slug }}"
              data-item-custom{{ $snipIndex }}-options="{{ range $vIndex, $val := $opt.values }}{{ if $vIndex }}|{{ end }}{{ if reflect.IsMap $val }}{{ $val.name }} {{ if $val.price }}[+{{ printf "%.2f" $val.price }}]{{ end }}{{ else }}{{ $val }}{{ end }}{{ end }}"
            {{ end }}
          >
            {{ i18n "product_btn_add" }}
          </button>
        </div>
        <div class="product-info">
          <h3 class="font-serif">{{ .Title }}</h3>
          <p>{{ .Params.category }} / {{ index .Params.tags 0 }}</p>
          <div class="product-price">
            {{ printf (i18n "product_price_format") .Params.price }}
          </div>
          <!-- Learn More Link -->
          <a href="{{ .RelPermalink }}" class="learn-more-link" style="margin-top: 1rem; display: inline-block; font-size: 0.9rem; color: var(--accent-green); text-decoration: underline;">
            {{ if eq .Site.Language.Lang "tb-poj" }}Khòaⁿ siū-sè →{{ else if eq .Site.Language.Lang "tb-hj" }}瞭解更多 →{{ else }}Learn More →{{ end }}
          </a>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>
