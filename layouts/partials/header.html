<header class="site-header">
  
  <div class="header-inner">

    <!-- Logo + Site Title -->
    <a href="{{ "/" | relLangURL }}" class="logo-block">
      <div>
        <img src="/img/HongMouSa Logo.png" alt="HongMouSa Studio Logo" />
      </div>
    
      <div class="site-title">
        <div class="site-title-l1">Hong-mô͘-sa Kang-chok-sek</div>
        <div class="site-title-l2">芳芼莎工作室</div>
        <div class="site-title-l3">HongMouSa Studio</div>
      </div>
    </a>

    <!-- Desktop Navigation -->
    {{ partial "nav.html" . }}

    <!-- Language Switcher (desktop only) -->
    <div class="lang-desktop">
      {{ partial "lang-switch.html" . }}
    </div>
    
    <!-- Hamburger (mobile only) -->
    <div class="menu-toggle">☰</div>

    <!-- Icons (Search, User, Cart) -->
    <div class="icons-group">

      <!-- Search -->
      <button aria-label="Search">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button>

      <!-- Auth (Member Dropdown) -->
      <div class="member-dropdown">

        <!-- Member icon (always visible) -->
        <button class="member-toggle" aria-label="User menu">
          <i class="fa-regular fa-user"></i>
        </button>
        
        <!-- Dropdown menu -->
        <div class="member-menu">
          <div class="member-menu-inner">

            <!-- Logged-in info -->
            <div class="member-info auth-only">
              <span class="member-email"></span>
            </div>

            <ul class="member-links">
              <!-- Not logged in -->
              <li class="login-only">
                <a href="{{ "login/" | relLangURL }}" class="member-link">Login</a>
              </li>

              <li class="login-only">
                <a href="{{ "register/" | relLangURL }}" class="member-link">Register</a>
              </li>

              <!-- Logged in -->
              <li class="auth-only">
                <a href="{{ "account/" | relLangURL }}" class="member-link">My Account</a>
              </li>

              <li class="auth-only">
                <button id="logout-btn" class="member-link">Logout</button>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Cart (Snipcart Checkout)-->
      <button class="snipcart-checkout" aria-label="Cart">
        <i class="fa-solid fa-cart-shopping"></i>
        <!-- Kò͘-bu̍t-chhia sò͘-liōng -->
        <span class="snipcart-items-count cart-count">0</span>
      </button>
    </div>
  </div>

  
  <!-- Mobile Hamburger dropdown -->
  <div id="menuMobile" class="menu-mobile">
    
    <nav class="nav-mobile">
      {{ partial "nav-mobile.html" . }}
    </nav>

    <!-- mobile language -->
    <div class="lang-mobile">
      {{ partial "lang-switch.html" . }}
    </div>
  </div>
</header>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const btn = document.querySelector('.menu-toggle');
  const menu = document.getElementById('menuMobile');

  if (!btn || !menu) return;

  // accessibility
  btn.setAttribute('aria-controls', 'menuMobile');
  btn.setAttribute('aria-expanded', 'false');
  btn.setAttribute('role', 'button');

  btn.addEventListener('click', function (e) {
    const isOpen = menu.classList.toggle('show');
    btn.setAttribute('aria-expanded', String(isOpen));
  });

  // close when clicking outside
  document.addEventListener('click', function (e) {
    if (!menu.classList.contains('show')) return;
    if (menu.contains(e.target) || btn.contains(e.target)) return;
    menu.classList.remove('show');
    btn.setAttribute('aria-expanded', 'false');
  });
});
</script>

