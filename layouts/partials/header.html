<header class="site-header">
  
  <div class="header-inner">

    <!-- Mobile/Tablet Menu Toggle (Moved out of actions) -->
    <button class="menu-toggle" aria-label="Toggle Navigation" aria-expanded="false">
      <i class="fa-solid fa-bars"></i>
    </button>

    <!-- Logo + Site Title -->
    <a href="{{ .Site.BaseURL | relLangURL }}" class="logo-block">
      <div>
        <img src="/img/HongMouSa Logo.png" alt="HongMouSa Studio Logo" />
      </div>
    
      <div class="site-title">
        <div class="site-title-l1">Hong-mô͘-sa Kang-chok-sek</div>
        <div class="site-title-l2">芳芼莎工作室</div>
        <div class="site-title-l3">HongMouSa Studio</div>
      </div>
    </a>

    <!-- Desktop Navigation -->
    {{ partial "nav.html" . }}

    <!-- Right Side Actions Group -->
      
      <!-- Icons (Search - Moved to FAB) -->

      <!-- Language Switcher (Now on the far right) -->
      <div class="lang-desktop">
        {{ partial "lang-switch.html" . }}
      </div>
    </div>
  </div>

  
  <!-- Mobile Hamburger dropdown -->
  <div id="menuMobile" class="menu-mobile">
    
    <nav class="nav-mobile">
      {{ partial "nav-mobile.html" . }}
    </nav>


  </div>
</header>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const btn = document.querySelector('.menu-toggle');
  const icon = btn ? btn.querySelector('i') : null;
  const menu = document.getElementById('menuMobile');

  if (!btn || !menu) return;

  // Hamburger Logic (Click + Hover)
  let menuTimer;

  const showMenu = () => {
    clearTimeout(menuTimer);
    menu.classList.add('show');
    btn.setAttribute('aria-expanded', 'true');
    // Animate Icon
    if (icon) {
      icon.classList.remove('fa-bars');
      icon.classList.add('fa-xmark');
      icon.style.transform = 'rotate(90deg)';
    }
  };


  // Click Toggle
  btn.addEventListener('click', function (e) {
    e.stopPropagation();
    const isOpen = menu.classList.contains('show');
    if (isOpen) {
      hideMenu(true); // Force immediate hide
    } else {
      showMenu();
    }
  });

  const hideMenu = (immediate = false) => {
    const doHide = () => {
      menu.classList.remove('show');
      btn.setAttribute('aria-expanded', 'false');
      if (icon) {
        icon.classList.remove('fa-xmark');
        icon.classList.add('fa-bars');
        icon.style.transform = 'rotate(0deg)';
      }
    };

    if (immediate) {
      clearTimeout(menuTimer);
      doHide();
    } else {
      menuTimer = setTimeout(doHide, 300);
    }
  };

  // Hover Events (Desktop only)
  if (window.matchMedia('(hover: hover)').matches) {
    btn.addEventListener('mouseenter', showMenu);
    btn.addEventListener('mouseleave', () => hideMenu(false));
    menu.addEventListener('mouseenter', showMenu);
    menu.addEventListener('mouseleave', () => hideMenu(false));
  }

  // Auto-close on link click
  menu.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => hideMenu(true));
  });

  // Close when clicking outside
  document.addEventListener('click', function (e) {
    if (!menu.classList.contains('show')) return;
    if (menu.contains(e.target) || btn.contains(e.target)) return;
    
    // Force hide
    clearTimeout(menuTimer);
    menu.classList.remove('show');
    btn.setAttribute('aria-expanded', 'false');
    if (icon) {
      icon.classList.remove('fa-xmark');
      icon.classList.add('fa-bars');
      icon.style.transform = 'rotate(0deg)';
    }
  });

});
</script>
