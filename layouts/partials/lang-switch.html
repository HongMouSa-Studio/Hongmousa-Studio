<div class="group lang-switcher-inline">
  
  <!-- Button -->
  <button class="lang-button" data-lang="{{ .Site.Language.Lang }}">
    üåê {{ .Site.Language.Lang | upper }}
  </button>

  <!-- Dropdown -->
  <div class="lang-dropdown">

    {{ $cur := .Page.RelPermalink }}
    {{ $fromPrefix := printf "/%s/" .Site.Language.Lang }}
    
    {{ range .Site.Languages }}
      {{ $targetPrefix := printf "/%s/" .Lang }}
      {{ if in $cur $fromPrefix }}
        <a href="{{ replace $cur $fromPrefix $targetPrefix }}"
           class="lang-option" data-lang="{{ .Lang }}"
           onclick="document.cookie='preferred_lang={{ .Lang }};path=/;max-age=31536000';">
          {{ .LanguageName }}
        </a>
      {{ else }}
        <a href="/{{ .Lang }}/"
           class="lang-option" data-lang="{{ .Lang }}"
           onclick="document.cookie='preferred_lang={{ .Lang }};path=/;max-age=31536000';">
          {{ .LanguageName }}
        </a>
      {{ end }}
    {{ end }}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const group = document.querySelector('.lang-switcher-inline');
  const button = group.querySelector('.lang-button');
  const dropdown = group.querySelector('.lang-dropdown');

  group.addEventListener('mouseenter', () => {
    dropdown.classList.add("show");
  });

  group.addEventListener('mouseleave', () => {
    dropdown.classList.remove("show");
  });

    // keyboard accessibility: toggle with Enter/Space
  button.addEventListener('keydown', function (e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      const isOpen = dropdown.style.visibility === 'visible';
      if (isOpen) {
        dropdown.style.opacity = '0'; dropdown.style.visibility = 'hidden';
        button.setAttribute('aria-expanded', 'false');
      } else {
        dropdown.style.opacity = '1'; dropdown.style.visibility = 'visible';
        button.setAttribute('aria-expanded', 'true');
        dropdown.querySelector('a')?.focus();
      }
    }
  });
});
</script>
