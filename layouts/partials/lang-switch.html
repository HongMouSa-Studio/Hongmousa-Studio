<div class="group lang-switcher-inline">
  
  <!-- Button (Globe Icon + Active Lang Label) -->
  <button class="icon-btn lang-button" aria-label="Language" data-lang="{{ .Site.Language.Lang }}">
    <i class="fa-solid fa-globe"></i>
    <span class="active-lang-label">
      {{ i18n "cur_lang_name" }}
    </span>
    <i class="fa-solid fa-chevron-down chevron-icon"></i>
  </button>

  <!-- Dropdown -->
  <div class="lang-dropdown">

    {{ $curLang := .Site.Language.Lang }}
    {{ $curPath := .Page.RelPermalink }}
    {{ $fromPrefix := printf "/%s/" $curLang }}
    
    {{ range .Site.Languages }}
      {{ $targetPrefix := printf "/%s/" .Lang }}
      {{ $isActive := eq .Lang $curLang }}
      
      {{ if in $curPath $fromPrefix }}
        <a href="{{ replace $curPath $fromPrefix $targetPrefix }}"
           class="lang-option {{ if $isActive }}current-lang{{ end }}" data-lang="{{ .Lang }}"
           onclick="document.cookie='preferred_lang={{ .Lang }};path=/;max-age=31536000';">
          {{ .LanguageName }}
        </a>
      {{ else }}
        <a href="/{{ .Lang }}/"
           class="lang-option {{ if $isActive }}current-lang{{ end }}" data-lang="{{ .Lang }}"
           onclick="document.cookie='preferred_lang={{ .Lang }};path=/;max-age=31536000';">
          {{ .LanguageName }}
        </a>
      {{ end }}
    {{ end }}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const group = document.querySelector('.lang-switcher-inline');
  const button = group.querySelector('.lang-button');
  const dropdown = group.querySelector('.lang-dropdown');
  let leaveTimer;

  const showDropdown = () => {
    clearTimeout(leaveTimer);
    dropdown.classList.add("show");
    button.setAttribute('aria-expanded', 'true');
  };

  const hideDropdown = () => {
    leaveTimer = setTimeout(() => {
      dropdown.classList.remove("show");
      button.setAttribute('aria-expanded', 'false');
    }, 300); // 300ms grace period
  };

  // Mouse interactions
  group.addEventListener('mouseenter', showDropdown);
  group.addEventListener('mouseleave', hideDropdown);
  
  // Also keep open if hovering the dropdown itself (redundant but safe)
  dropdown.addEventListener('mouseenter', showDropdown);
  dropdown.addEventListener('mouseleave', hideDropdown);

  // Keyboard accessibility
  button.addEventListener('keydown', function (e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      const isOpen = dropdown.classList.contains('show');
      if (isOpen) {
        dropdown.classList.remove('show');
      } else {
        dropdown.classList.add('show');
      }
    }
  });
});
</script>
