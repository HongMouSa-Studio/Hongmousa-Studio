<script>
(function () {
  // Chit tōaⁿ kan-na hū-chek tī production chū-tōng/cookie redirect, m̄-kú kan-na ē tùi "sìn-jīm ê domain" tōng-chok.
  // Kā beh tī production bīn-téng chiap-siū ê redirect ê domain khē ji̍p pe̍h-miâ-toaⁿ:
  const allowedHosts = [
    "hongmousa-studio.pages.dev",
    "www.hongmousa-studio.pages.dev" // Nā ū su-iàu
  ];
  
  // Localhost → Mài redirect
  if (location.hostname === "localhost") return;

  // Production domain ì-gōa → Mài redirect
  if (!allowedHosts.includes(location.hostname)) return;

  // Kiám-cha cookie
  const cookie = document.cookie.split("; ").find(r => r.startsWith("preferred_lang="));
 
  if (cookie) {
    const lang = cookie.split("=")[1];
    const desired = "/" + lang + "/";

    // Kan-na redirect root pages (pī-bián kan-jiáu lāi-ia̍h)
    if (location.pathname === "/" || location.pathname === "") {
      if (!location.pathname.startsWith(desired)) {
        location.href = desired;
      }
    }
    return;
  }

  // Bô cookie → auto-detect
  const userLang = navigator.language.toLowerCase();
  const autoLang = (userLang.startsWith("zh") || userLang.startsWith("ja"))
    ? "tb-hj"
    : "en";
  
  const target = "/" + autoLang + "/";

  // Kan-na tī siú-ia̍h chù-tiōng thiàu (pī-bián phò-hāi lāi-ia̍h)
  if (location.pathname === "/" || location.pathname === "") {
    location.href = target;
  }
})();
</script>
