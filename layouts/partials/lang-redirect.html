<script>
(function () {
  // Pún-tē khai-hoat khoân-kéng kim-iōng redirect
  if (location.host.includes("localhost")) return;

  // cookie gí-giân
  const cookie = document.cookie
    .split("; ")
    .find(r => r.startsWith("preferred_lang="));

  // Nā lâng-kheh bat siat-tēng--kòe to̍h tòe cookie
  if (cookie) {
    const lang = cookie.split("=")[1];
    const desired = "/" + lang + "/";

    if (!location.pathname.startsWith(desired)) {
      location.href = desired;
    }
    return; // cookie í-keng chhú-lí soah
  }

  // Chū-tōng chhiâu gí-hē (Ah-bōe siat-tēng cookie chiah ē iōng)
  const userLang = (navigator.language || "").toLowerCase();

  let autoLang = "en";

  if (userLang.startsWith("zh") || userLang.startsWith("ja")) {
    autoLang = "tb-hj"; // Tiong-bûn/Ji̍t-bûn → TB-HJ
  }

  const target = "/" + autoLang + "/";

  if (!location.pathname.startsWith(target)) {
    location.href = target;
  }
})();
</script>
